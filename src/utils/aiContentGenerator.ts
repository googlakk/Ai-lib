import { GoogleGenerativeAI } from '@google/generative-ai';

interface ServiceInfo {
  title: string;
  description: string;
  category: string;
  url?: string;
}

interface GeneratedContent {
  instructions: string;
  examples: string;
  tags: string[];
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Gemini AI
const getGeminiAI = () => {
  const apiKey = import.meta.env.VITE_GEMINI_API_KEY;
  console.log('API Key found:', apiKey ? 'Yes' : 'No');
  console.log('API Key length:', apiKey?.length || 0);
  
  if (!apiKey) {
    throw new Error('VITE_GEMINI_API_KEY –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è');
  }
  return new GoogleGenerativeAI(apiKey);
};

export async function generateServiceContent(serviceInfo: ServiceInfo): Promise<GeneratedContent> {
  try {
    console.log('–ù–∞—á–∏–Ω–∞–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è:', serviceInfo.title);
    const genAI = getGeminiAI();
    const model = genAI.getGenerativeModel({ model: "gemini-pro" });
    
    const { title, description, category } = serviceInfo;

    const prompt = `
–¢—ã —ç–∫—Å–ø–µ—Ä—Ç –≤ –æ–±–ª–∞—Å—Ç–∏ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π –∏ AI-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è —É—á–∏—Ç–µ–ª–µ–π. 
–°–æ–∑–¥–∞–π –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –∏ –ø—Ä–∏–º–µ—Ä—ã –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –¥–ª—è AI-—Å–µ—Ä–≤–∏—Å–∞.

**–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Ä–≤–∏—Å–µ:**
- –ù–∞–∑–≤–∞–Ω–∏–µ: ${title}
- –û–ø–∏—Å–∞–Ω–∏–µ: ${description}
- –ö–∞—Ç–µ–≥–æ—Ä–∏—è: ${category}
${serviceInfo.url ? `- URL: ${serviceInfo.url}` : ''}

**–ó–∞–¥–∞—á–∞:**
–°–æ–∑–¥–∞–π —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ –ø–æ–ª—è–º–∏:

1. **instructions** - –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Å–µ—Ä–≤–∏—Å–∞ (7-10 –ø—É–Ω–∫—Ç–æ–≤)
2. **examples** - –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –≤ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–º –ø—Ä–æ—Ü–µ—Å—Å–µ, —Ä–∞–∑–¥–µ–ª–µ–Ω–Ω—ã–µ –ø–æ —Ç–µ–º–∞—Ç–∏–∫–∞–º —Å —ç–º–æ–¥–∑–∏
3. **tags** - –ú–∞—Å—Å–∏–≤ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ç–µ–≥–æ–≤ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ (5-8 —Ç–µ–≥–æ–≤)

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –∏ –ø–æ–Ω—è—Ç–Ω—ã–º–∏ –¥–ª—è —É—á–∏—Ç–µ–ª–µ–π
- –ü—Ä–∏–º–µ—Ä—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–º–∏ –∏ –ø—Ä–∏–º–µ–Ω–∏–º—ã–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º —É—á–µ–±–Ω–æ–º –ø—Ä–æ—Ü–µ—Å—Å–µ
- –¢–µ–≥–∏ –¥–æ–ª–∂–Ω—ã –æ—Ç—Ä–∞–∂–∞—Ç—å –ø—Ä–µ–¥–º–µ—Ç–Ω—É—é –æ–±–ª–∞—Å—Ç—å –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- –¢–µ–∫—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
- –£—á–∏—Ç—ã–≤–∞–π —Å–ø–µ—Ü–∏—Ñ–∏–∫—É –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "${category}"

**–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:** –¢–æ–ª—å–∫–æ JSON –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤:
{
  "instructions": "—Ç–µ–∫—Å—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π",
  "examples": "—Ç–µ–∫—Å—Ç –ø—Ä–∏–º–µ—Ä–æ–≤ —Å —ç–º–æ–¥–∑–∏ –∏ —Ä–∞–∑–¥–µ–ª–∞–º–∏",
  "tags": ["—Ç–µ–≥1", "—Ç–µ–≥2", "—Ç–µ–≥3"]
}
`;

    console.log('–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –∫ Gemini API...');
    const result = await model.generateContent(prompt);
    const response = await result.response;
    const text = response.text();
    console.log('–û—Ç–≤–µ—Ç –æ—Ç Gemini:', text.substring(0, 200) + '...');
    
    try {
      // –ü—ã—Ç–∞–µ–º—Å—è —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å JSON –∏–∑ –æ—Ç–≤–µ—Ç–∞
      const jsonMatch = text.match(/\{[\s\S]*\}/);
      if (jsonMatch) {
        const generatedData = JSON.parse(jsonMatch[0]);
        
        return {
          instructions: generatedData.instructions || fallbackInstructions(title),
          examples: generatedData.examples || fallbackExamples(title, category),
          tags: Array.isArray(generatedData.tags) ? generatedData.tags : fallbackTags(category)
        };
      } else {
        throw new Error('JSON –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –æ—Ç–≤–µ—Ç–µ');
      }
    } catch (parseError) {
      console.warn('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON –æ—Ç Gemini, –∏—Å–ø–æ–ª—å–∑—É–µ–º fallback:', parseError);
      return getFallbackContent(title, description, category);
    }
    
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ Gemini:', error);
    console.error('–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏:', error instanceof Error ? error.message : error);
    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º fallback –∫–æ–Ω—Ç–µ–Ω—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ API
    return getFallbackContent(title, description, category);
  }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ–ø–∏—Å–∞–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ URL —Å –ø–æ–º–æ—â—å—é Gemini
export async function generateDescriptionFromUrl(url: string, title: string): Promise<string> {
  try {
    const genAI = getGeminiAI();
    const model = genAI.getGenerativeModel({ model: "gemini-pro" });
    
    const prompt = `
–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π URL –∏ —Å–æ–∑–¥–∞–π –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ AI-—Å–µ—Ä–≤–∏—Å–∞ –¥–ª—è –∫–∞—Ç–∞–ª–æ–≥–∞ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤.

**–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:**
- –ù–∞–∑–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞: ${title}
- URL: ${url}

**–ó–∞–¥–∞—á–∞:**
–°–æ–∑–¥–∞–π –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è) –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ, –∫–æ—Ç–æ—Ä–æ–µ:
- –û–±—ä—è—Å–Ω—è–µ—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ –¥–ª—è —É—á–∏—Ç–µ–ª–µ–π
- –û–ø–∏—Å—ã–≤–∞–µ—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- –ü–æ–¥—á–µ—Ä–∫–∏–≤–∞–µ—Ç –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—É—é —Ü–µ–Ω–Ω–æ—Å—Ç—å

**–§–æ—Ä–º–∞—Ç:** –¢–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç –æ–ø–∏—Å–∞–Ω–∏—è, –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤.
`;

    const result = await model.generateContent(prompt);
    const response = await result.response;
    const text = response.text().trim();
    
    return text || getFallbackDescription(url, title);
    
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ–ø–∏—Å–∞–Ω–∏—è —á–µ—Ä–µ–∑ Gemini:', error);
    return getFallbackDescription(url, title);
  }
}

// Fallback —Ñ—É–Ω–∫—Ü–∏–∏
function getFallbackContent(title: string, description: string, category: string): GeneratedContent {
  return {
    instructions: fallbackInstructions(title),
    examples: fallbackExamples(title, category),
    tags: fallbackTags(category)
  };
}

function fallbackInstructions(title: string): string {
  return `–ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é ${title}:

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å–µ—Ä–≤–∏—Å –≤ –≤–µ–±-–±—Ä–∞—É–∑–µ—Ä–µ
2. –û–∑–Ω–∞–∫–æ–º—å—Ç–µ—Å—å —Å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º –∏ –æ—Å–Ω–æ–≤–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏
3. –°–ª–µ–¥—É–π—Ç–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–º—É —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤—É –∏–ª–∏ —Ç—É—Ç–æ—Ä–∏–∞–ª—É
4. –ù–∞—á–Ω–∏—Ç–µ —Å –ø—Ä–æ—Å—Ç—ã—Ö –∑–∞–¥–∞—á –¥–ª—è –æ—Å–≤–æ–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞
5. –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –∫ –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º
6. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ø—Ä–∞–≤–æ—á–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
7. –î–µ–ª–∏—Ç–µ—Å—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ —Å –∫–æ–ª–ª–µ–≥–∞–º–∏ –∏ —É—á–µ–Ω–∏–∫–∞–º–∏
8. –†–µ–≥—É–ª—è—Ä–Ω–æ –∏–∑—É—á–∞–π—Ç–µ –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è`;
}

function fallbackExamples(title: string, category: string): string {
  const categoryExamples: Record<string, string> = {
    '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞': `–ü—Ä–∏–º–µ—Ä—ã –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è ${title} –≤ –æ–±—É—á–µ–Ω–∏–∏ –º–∞—Ç–µ–º–∞—Ç–∏–∫–µ:

üìö **–ù–∞ —É—Ä–æ–∫–∞—Ö –∞–ª–≥–µ–±—Ä—ã:**
- –†–µ—à–µ–Ω–∏–µ —É—Ä–∞–≤–Ω–µ–Ω–∏–π —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º
- –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–º–∞—à–Ω–∏—Ö –∑–∞–¥–∞–Ω–∏–π

üìê **–ù–∞ —É—Ä–æ–∫–∞—Ö –≥–µ–æ–º–µ—Ç—Ä–∏–∏:**
- –î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ —Ç–µ–æ—Ä–µ–º
- –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–ª–æ—â–∞–¥–µ–π –∏ –æ–±—ä–µ–º–æ–≤
- –°–æ–∑–¥–∞–Ω–∏–µ –≥–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏—Ö –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–π`,

    '–§–∏–∑–∏–∫–∞': `–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ ${title} –Ω–∞ —É—Ä–æ–∫–∞—Ö —Ñ–∏–∑–∏–∫–∏:

‚ö° **–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã –∏ —Å–∏–º—É–ª—è—Ü–∏–∏:**
- –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã–µ —Ä–∞–±–æ—Ç—ã
- –ú–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
- –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤

üî¨ **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:**
- –†–µ—à–µ–Ω–∏–µ –∑–∞–¥–∞—á –ø–æ –º–µ—Ö–∞–Ω–∏–∫–µ
- –ò–∑—É—á–µ–Ω–∏–µ —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏—Ö —è–≤–ª–µ–Ω–∏–π
- –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —ç–∫–∑–∞–º–µ–Ω–∞–º`,

    '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫': `–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ ${title} –≤ –∏–∑—É—á–µ–Ω–∏–∏ –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ —è–∑—ã–∫–∞:

üìù **–†–∞–∑–≤–∏—Ç–∏–µ –Ω–∞–≤—ã–∫–æ–≤:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥—Ä–∞–º–º–∞—Ç–∏–∫–∏ –∏ —Å—Ç–∏–ª—è
- –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –ø—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏—è
- –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å–ª–æ–≤–∞—Ä–Ω–æ–≥–æ –∑–∞–ø–∞—Å–∞

üó£Ô∏è **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞:**
- –î–∏–∞–ª–æ–≥–æ–≤—ã–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
- –ò–∑—É—á–µ–Ω–∏–µ –∏–¥–∏–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π
- –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —è–∑—ã–∫–æ–≤—ã–º —ç–∫–∑–∞–º–µ–Ω–∞–º`
  };

  return categoryExamples[category] || `–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è ${title}:

üéì **–í –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–º –ø—Ä–æ—Ü–µ—Å—Å–µ:**
- –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö —É—Ä–æ–∫–æ–≤
- –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏–π –¥–ª—è —É—á–µ–Ω–∏–∫–æ–≤
- –û—Ü–µ–Ω–∫–∞ –∏ –∞–Ω–∞–ª–∏–∑ —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏

üí° **–ü–æ–≤—ã—à–µ–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:**
- –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —Ä—É—Ç–∏–Ω–Ω—ã—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—É—á–µ–Ω–∏—è
- –ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏`;
}

function fallbackTags(category: string): string[] {
  const categoryTags: Record<string, string[]> = {
    '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞': ['–º–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–∞–ª–≥–µ–±—Ä–∞', '–≥–µ–æ–º–µ—Ç—Ä–∏—è', '—Ä–µ—à–µ–Ω–∏–µ –∑–∞–¥–∞—á', '–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ', '—à–∫–æ–ª–∞'],
    '–§–∏–∑–∏–∫–∞': ['—Ñ–∏–∑–∏–∫–∞', '—ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã', '—Å–∏–º—É–ª—è—Ü–∏—è', '–ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞', '–Ω–∞—É–∫–∞', '–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ'],
    '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫': ['–∞–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', '–≥—Ä–∞–º–º–∞—Ç–∏–∫–∞', '–ø—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏–µ', '—Å–ª–æ–≤–∞—Ä—å', '–∏–∑—É—á–µ–Ω–∏–µ —è–∑—ã–∫–æ–≤', 'ESL'],
    '–ò—Å—Ç–æ—Ä–∏—è': ['–∏—Å—Ç–æ—Ä–∏—è', '–¥–∞—Ç—ã', '—Å–æ–±—ã—Ç–∏—è', '—Ö—Ä–æ–Ω–æ–ª–æ–≥–∏—è', '–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ', '—à–∫–æ–ª–∞'],
    '–•–∏–º–∏—è': ['—Ö–∏–º–∏—è', '—Ä–µ–∞–∫—Ü–∏–∏', '—ç–ª–µ–º–µ–Ω—Ç—ã', '–ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞', '—ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã', '–Ω–∞—É–∫–∞']
  };

  return categoryTags[category] || ['–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ', '–æ–±—É—á–µ–Ω–∏–µ', 'AI', '—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏', '—à–∫–æ–ª–∞', '—É—á–∏—Ç–µ–ª—å'];
}

function getFallbackDescription(url: string, title: string): string {
  const domain = new URL(url).hostname.toLowerCase();
  
  if (domain.includes('chat') || domain.includes('gpt')) {
    return `${title} - –º–æ—â–Ω—ã–π AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞, —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞–Ω–æ–≤ —É—Ä–æ–∫–æ–≤ –∏ –ø–æ–º–æ—â–∏ –≤ –æ–±—É—á–µ–Ω–∏–∏. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ —è–∑—ã–∫–æ–≤ –∏ –ø—Ä–µ–¥–º–µ—Ç–Ω—ã—Ö –æ–±–ª–∞—Å—Ç–µ–π.`;
  } else if (domain.includes('math') || domain.includes('calculate')) {
    return `${title} - –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á —Å –ø–æ—à–∞–≥–æ–≤—ã–º–∏ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è–º–∏. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞–ª–≥–µ–±—Ä—É, –≥–µ–æ–º–µ—Ç—Ä–∏—é, –∞–Ω–∞–ª–∏–∑ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É.`;
  } else if (domain.includes('translate') || domain.includes('language')) {
    return `${title} - AI-–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è —è–∑—ã–∫–æ–≤ —Å –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ø–æ–¥—Ö–æ–¥–æ–º, –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–º–∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è–º–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ø—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏—è.`;
  }
  
  return `${title} - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π AI-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–æ–∂–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä—É—Ç–∏–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ –∏ —Å–¥–µ–ª–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ –±–æ–ª–µ–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–º –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–º.`;
}